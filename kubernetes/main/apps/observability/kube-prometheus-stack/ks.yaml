---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: kube-prometheus-stack
  namespace: flux-system
spec:
  suspend: true
  dependsOn:
    - name: ingress-nginx-external
    - name: external-secrets
  path: ./kubernetes/main/apps/observability/kube-prometheus-stack/app
  prune: true
  sourceRef:
    kind: GitRepository
    name: home-kubernetes
  wait: false # no flux ks dependents
  interval: 30m
  retryInterval: 1m
  timeout: 5m
  #patches:
  #  - patch: |
  #      - op: add
  #        path: /spec/template/spec/containers/0/args/-
  #        value: --concurrent=8
  #      - op: add
  #        path: /spec/template/spec/containers/0/args/-
  #        value: --kube-api-qps=500
  #      - op: add
  #        path: /spec/template/spec/containers/0/args/-
  #        value: --kube-api-burst=1000
  #      - op: add
  #        path: /spec/template/spec/containers/0/args/-
  #        value: --requeue-dependency=5s
  #    target:
  #      kind: Deployment
  #      name: (kustomize-controller|helm-controller|source-controller)
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: kube-prometheus-stack-monitoring
  namespace: flux-system
spec:
  suspend: true
  path: ./kubernetes/main/apps/observability/kube-prometheus-stack/monitoring
  prune: true
  sourceRef:
    kind: GitRepository
    name: home-kubernetes
  wait: false # no flux ks dependents
  interval: 30m
  retryInterval: 1m
  timeout: 5m
