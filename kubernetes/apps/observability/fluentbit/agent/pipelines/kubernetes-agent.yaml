pipeline:
  inputs:
    - name: tail
      alias: kubernetes
      path: /var/log/containers/*.log
      parser: containerd
      tag: kubernetes.*
      skip_empty_lines: on
      skip_long_lines: on
      refresh_interval: 5
      rotate_wait: 30
      ignore_older: 1h
      mem_buf_limit: 50MB #50MB - 100MB

  filters:
    - name: modify
      match: '*'
      copy: log _msg

  outputs:
    - name: kafka
      match: '*'
      brokers: kafka-cluster-kafka-brokers.databases.svc.cluster.local:9093
      topics: cluster-apps-logs
      rdkafka.client.id: fluent-bit
      rdkafka.enable.ssl.certificate.verification: true
      rdkafka.ssl.certificate.location: /fluent-bit/etc/secrets/user.crt
      rdkafka.ssl.key.location: /fluent-bit/etc/secrets/user.key
      rdkafka.ssl.ca.location: /fluent-bit/etc/secrets/ca.crt
      rdkafka.security.protocol: ssl
      rdkafka.request.required.acks: 1
      rdkafka.message.send.max.retries: 5
      rdkafka.retry.backoff.ms: 300
      rdkafka.message.max.bytes: 5242880          # 5MB
      rdkafka.queue.buffering.max.kbytes: 262144  # 256MB buffer
      rdkafka.compression.codec: gzip
      rdkafka.batch.num.messages: 500
      rdkafka.linger.ms: 2
      format: json

