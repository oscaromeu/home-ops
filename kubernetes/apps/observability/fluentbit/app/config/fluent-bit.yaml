service:
  daemon: false
  flush: 1
  log_level: warn
  parsers_file: /fluent-bit/etc/conf/parsers.d/parsers.yaml
  http_server: true
  http_listen: 0.0.0.0
  http_port: 2020
  health_check: true
pipeline:
  inputs:
    - name: tail
      alias: kubernetes
      path: /var/log/containers/*.log
      parser: containerd
      tag: kubernetes.*
      skip_empty_lines: on
      skip_long_lines: on
  filters:
    - name: kubernetes
      match: kubernetes.*
      merge_log: true
      kube_tag_prefix: kubernetes.var.log.containers.
      k8s-logging.parser: true
      k8s-logging.exclude: true
      namespace_labels: false
      annotations: false
    - name: nest
      match: kubernetes.*
      operation: lift
      nested_under: kubernetes
      add_prefix: k_
    - name: nest
      match: kubernetes.*
      operation: lift
      nested_under: k_labels
      add_prefix: k_labels_
    - name: modify
      match: kubernetes.*
      rename: k_labels_app.kubernetes.io/name app
      rename: k_labels_app app
      rename: k_labels_k8s-app app
  outputs:
    - name: http
      match: kubernetes.*
      host: victoria-logs-server.observability.svc.cluster.local
      port: 9428
      uri: /insert/jsonline?_stream_fields=stream,k_namespace_name,k_pod_name,app&_msg_field=log&_time_field=date
      format: json_lines
      json_date_format: iso8601
      compress: gzip
      log_response_payload: false

