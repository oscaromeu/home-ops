---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/helm.toolkit.fluxcd.io/helmrelease_v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: fluent-bit
spec:
  chartRef:
    kind: OCIRepository
    name: fluent-bit
  values:
    image:
      repository: cr.fluentbit.io/fluent/fluent-bit
      tag: 4.2.2-debug
    args:
      - --workdir=/fluent-bit/etc
      - --config=/fluent-bit/etc/conf/fluent-bit.yaml
    dashboards:
      enabled: true
    serviceMonitor:
      enabled: true
    logLevel: warn
    extraVolumes:
      - name: parsers
        configMap:
          defaultMode: 420
          name: parsers
    extraVolumeMounts: 
      - name: parsers
        mountPath: /fluent-bit/etc/conf/parsers.d
        #subPath: parsers.yaml
        
