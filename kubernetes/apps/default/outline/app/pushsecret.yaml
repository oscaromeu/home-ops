---
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: &name outline-secret
spec:
  updatePolicy: Replace
  #deletionPolicy: Delete
  #refreshInterval: 15m
  secretStoreRefs:
    - name: onepassword-connect
      kind: ClusterSecretStore
  selector:
    secret:
      name: *name
  template:
    engineVersion: v2
    data:
      AWS_ACCESS_KEY_ID: '{{ index . "AWS_ACCESS_KEY_ID" }}'
      AWS_S3_UPLOAD_BUCKET_NAME: '{{ index . "AWS_S3_UPLOAD_BUCKET_NAME" }}'
      AWS_S3_UPLOAD_BUCKET_URL: '{{ index . "AWS_S3_UPLOAD_BUCKET_URL" }}'
      AWS_SECRET_ACCESS_KEY: '{{ index . "AWS_SECRET_ACCESS_KEY" }}'
      DATABASE_URL: '{{ index . "DATABASE_URL" }}'
      INIT_POSTGRES_DBNAME: '{{ index . "INIT_POSTGRES_DBNAME" }}'
      INIT_POSTGRES_HOST: '{{ index . "INIT_POSTGRES_HOST" }}'
      INIT_POSTGRES_PASS: '{{ index . "INIT_POSTGRES_PASS" }}'
      INIT_POSTGRES_SUPER_PASS: '{{ index . "INIT_POSTGRES_SUPER_PASS" }}'
      INIT_POSTGRES_USER: '{{ index . "INIT_POSTGRES_USER" }}'
      OIDC_CLIENT_SECRET: '{{ index . "OIDC_CLIENT_SECRET" }}'
      POSTGRES_DB: '{{ index . "POSTGRES_DB" }}'
      POSTGRES_HOST: '{{ index . "POSTGRES_HOST" }}'
      POSTGRES_PASS: '{{ index . "POSTGRES_PASS" }}'
      POSTGRES_SUPER_PASS: '{{ index . "POSTGRES_SUPER_PASS" }}'
      POSTGRES_USER: '{{ index . "POSTGRES_USER" }}'
      SECRET_KEY: '{{ index . "SECRET_KEY" }}'
      SMTP_RELAY_SERVER: '{{ index . "SMTP_RELAY_SERVER" }}'
      UTILS_SECRET: '{{ index . "UTILS_SECRET" }}'
    metadata:
      annotations:
        key: annotation
      labels:
        key: label
  data:
    - match:
        secretKey: &key AWS_ACCESS_KEY_ID
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key AWS_S3_UPLOAD_BUCKET_NAME
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key AWS_S3_UPLOAD_BUCKET_URL
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key AWS_SECRET_ACCESS_KEY
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key DATABASE_URL
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key INIT_POSTGRES_DBNAME
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key INIT_POSTGRES_HOST
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key INIT_POSTGRES_PASS
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key INIT_POSTGRES_SUPER_PASS
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key INIT_POSTGRES_USER
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key OIDC_CLIENT_SECRET
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key POSTGRES_DB
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key POSTGRES_HOST
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key POSTGRES_PASS
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key POSTGRES_SUPER_PASS
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key POSTGRES_USER
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key SECRET_KEY
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key SMTP_RELAY_SERVER
        remoteRef:
          remoteKey: *name
          property: *key
    - match:
        secretKey: &key UTILS_SECRET
        remoteRef:
          remoteKey: *name
          property: *key
    